<h2>Lista de amigos</h2>

    <div id="widget-amigos">
        <input type="text" class="form-control" placeholder="Filtrar por nombre"
               id="filtro-nombre"/>
        <button class="btn" onclick="cargarAmigosFiltrados()">Filtrar</button>
        <button class="btn" onclick="cargarAmigos()">Resetear filtro</button>

        <table class="table table-hover">
            <thead>
            <tr>
                <th>Nombre</th>
                <th>Email</th>
                <th class="col-md-1"></th>
            </tr>
            </thead>
            <tbody id="tablaCuerpo"></tbody>
        </table>
    </div>

<script>
    var amigos_ids = [];
    var amigos_nombres = [];
    var amigos_emails = [];
    window.history.pushState("", "", "/cliente.html?w=amigos");
    var URLbase = "https://localhost:8081/api";
    function cargarAmigos() {
        $.ajax({
            url: URLbase + "/amigosW",
            type: "GET",
            data: {},
            dataType: 'json',
            headers: {"token": token},
            success: function (respuesta) {
                amigos = respuesta;
                actualizarTabla(amigos);
            },
            error: function (error) {
                $("#contenedor-principal").load("widget-login.html");
            }
        });
    }

    function cargarAmigosFiltrados(nombre) {
        $.ajax({
            url: URLbase + "/amigosW",
            type: "GET",
            data: {},
            dataType: 'json',
            headers: {"token": token},
            success: function (respuesta) {
                amigos = respuesta;
                actualizarTablaFiltro(amigos, document.getElementById("filtro-nombre").value);
            },
            error: function (error) {
                $("#contenedor-principal").load("widget-login.html");
            }
        });
    }

    function actualizarTabla(amigos) {
        $("#tablaCuerpo").empty(); // Vaciar la tabla
        for (i = 0; i < amigos.amigos_ids.length; i++) {
            amigos_ids.push(amigos.amigos_ids[i]);
            amigos_nombres.push(amigos.amigos_nombres[i]);
            amigos_emails.push(amigos.amigos_email[i]);
            $("#tablaCuerpo").append(
                "<tr id=" + amigos.amigos_ids[i] + ">" +
                "<td>" + amigos.amigos_nombres[i] + "</td>" +
                "<td>" + amigos.amigos_email[i] + "</td>" +
                "<td><a class='btn btn-info messageButton' onclick=widgetMensajes('" + i + "')>Mensajes</a></td>" +
                "</tr>");
        }
    }

    function actualizarTablaFiltro(amigos, nombre) {
        $("#tablaCuerpo").empty(); // Vaciar la tabla
        for (i = 0; i < amigos.amigos_ids.length; i++) {
            amigos_ids.push(amigos.amigos_ids[i]);
            amigos_nombres.push(amigos.amigos_nombres[i]);
            amigos_emails.push(amigos.amigos_email[i]);
            if (amigos.amigos_nombres[i] == nombre) {
                $("#tablaCuerpo").append(
                    "<tr id=" + amigos.amigos_ids[i] + ">" +
                    "<td>" + amigos.amigos_nombres[i] + "</td>" +
                    "<td>" + amigos.amigos_email[i] + "</td>" +
                    "<td><a class='btn btn-info messageButton' onclick=widgetMensajes('" + i + "')>Mensajes</a></td>" +
                    "</tr>");
            }
        }
    }

    function widgetMensajes(valor) {
        let friendId = amigos_ids[valor];
        let friendEmail = amigos_emails[valor];
        window.history.pushState("", "", "/cliente.html?w=" + friendId + "&e=" + friendEmail);
        $("#contenedor-principal").load("widget-chat.html");
    }
    
    cargarAmigos();
</script>